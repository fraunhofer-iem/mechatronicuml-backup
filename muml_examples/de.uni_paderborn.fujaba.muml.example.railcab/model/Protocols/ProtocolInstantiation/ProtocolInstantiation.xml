<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
chan requestToCon, 
confirmInstantiationToCon, confirmInstantiationFromCon,
finalizeToCon, finalizeFromCon,
completedToCon, completedFromCon,
protocolNotSupportedToCon,
declineInstantiationToCon;

urgent chan requestFromCon, protocolNotSupportedFromCon,
declineInstantiationFromCon;

bool requestorFinal = false;
bool requesteeFinal = false;

const int minDelay = 0;
const int maxDelay = 25;</declaration><template><name x="5" y="5">Requestor</name><declaration>// Place local declarations here.
clock c1;</declaration><location id="id0" x="-152" y="128"><name x="-176" y="96">Success</name></location><location id="id1" x="48" y="128"><name x="24" y="80">WaitFinish</name><label kind="invariant" x="24" y="96">c1 &lt;= 350</label></location><location id="id2" x="256" y="128"><name x="224" y="144">WaitForPortCreation</name><label kind="invariant" x="280" y="120">c1 &lt;= 300</label></location><location id="id3" x="144" y="-24"><name x="104" y="-8">NotSupported</name></location><location id="id4" x="-16" y="-24"><name x="-40" y="-8">Aborted</name></location><location id="id5" x="256" y="-136"><name x="246" y="-166">SentRequest</name><label kind="invariant" x="272" y="-144">c1 &lt;= 400</label></location><location id="id6" x="32" y="-136"><name x="22" y="-166">Request</name><urgent/></location><location id="id7" x="-168" y="-136"><name x="-178" y="-166">Idle</name></location><init ref="id7"/><transition><source ref="id1"/><target ref="id0"/><label kind="synchronisation" x="-112" y="104">completedFromCon?</label><label kind="assignment" x="-120" y="128">requestorFinal = true</label></transition><transition><source ref="id2"/><target ref="id1"/><label kind="guard" x="112" y="88">c1 &gt;= 250</label><label kind="synchronisation" x="112" y="104">finalizeToCon!</label><label kind="assignment" x="92" y="128">c1 = 0</label></transition><transition><source ref="id5"/><target ref="id2"/><label kind="synchronisation" x="264" y="-8">confirmInstantiationFromCon?</label><label kind="assignment" x="264" y="80">c1 = 0</label></transition><transition><source ref="id5"/><target ref="id3"/><label kind="synchronisation" x="40" y="-64">protocolNotSupportedFromCon?</label><label kind="assignment" x="112" y="-56">requestorFinal = true</label></transition><transition><source ref="id5"/><target ref="id4"/><label kind="synchronisation" x="-80" y="-96">declineInstantiationFromCon?</label><label kind="assignment" x="-72" y="-80">requestorFinal = true</label></transition><transition><source ref="id6"/><target ref="id5"/><label kind="synchronisation" x="88" y="-160">requestToCon!</label><label kind="assignment" x="112" y="-136">c1 = 0</label></transition><transition><source ref="id7"/><target ref="id6"/></transition></template><template><name>Requestee</name><declaration>
clock c2;

bool supported, success;</declaration><location id="id8" x="-112" y="56"><name x="-160" y="24">Failed</name></location><location id="id9" x="-112" y="-16"><name x="-136" y="-48">Abort</name></location><location id="id10" x="-288" y="168"><name x="-312" y="136">Finished</name></location><location id="id11" x="-112" y="168"><name x="-152" y="128">CreateConnector</name><label kind="invariant" x="-122" y="183">c2 &lt;= 150</label></location><location id="id12" x="88" y="168"><name x="48" y="184">WaitRequestor</name><label kind="invariant" x="104" y="160">c2 &lt;= 450</label></location><location id="id13" x="88" y="56"><name x="96" y="24">CreatePort</name><label kind="invariant" x="104" y="48">c2 &lt;= 300</label></location><location id="id14" x="88" y="-104"><name x="78" y="-134">Request</name><label kind="invariant" x="112" y="-112">c2 &lt;= 50</label></location><location id="id15" x="-272" y="-104"><name x="-282" y="-134">Idle</name></location><init ref="id15"/><transition><source ref="id11"/><target ref="id10"/><label kind="guard" x="-232" y="128">c2 &gt;= 100</label><label kind="synchronisation" x="-256" y="144">completedToCon!</label><label kind="assignment" x="-260" y="168">requesteeFinal = true</label></transition><transition><source ref="id12"/><target ref="id11"/><label kind="synchronisation" x="-64" y="144">finalizeFromCon?</label><label kind="assignment" x="-56" y="168">c2 = 0</label></transition><transition><source ref="id13"/><target ref="id12"/><label kind="guard" x="96" y="80">success == true &amp;&amp; c2 &gt;= 250</label><label kind="synchronisation" x="96" y="104">confirmInstantiationToCon!</label><label kind="assignment" x="96" y="128">c2 = 0</label></transition><transition><source ref="id13"/><target ref="id8"/><label kind="guard" x="-112" y="16">success == false &amp;&amp; c2 &gt;= 250</label><label kind="synchronisation" x="-88" y="32">declineInstantiationToCon!</label><label kind="assignment" x="-72" y="56">requesteeFinal = true</label></transition><transition><source ref="id14"/><target ref="id9"/><label kind="guard" x="-128" y="-80">supported == false</label><label kind="synchronisation" x="-224" y="-64">protocolNotSupportedToCon!</label><label kind="assignment" x="-272" y="-48">requesteeFinal = true</label></transition><transition><source ref="id14"/><target ref="id13"/><label kind="select" x="96" y="-80">i : int[0,1]</label><label kind="guard" x="96" y="-64">supported == true</label><label kind="assignment" x="96" y="-40">c2 = 0, success = i</label></transition><transition><source ref="id15"/><target ref="id14"/><label kind="select" x="-224" y="-128">i : int[0,1]</label><label kind="synchronisation" x="-136" y="-128">requestFromCon?</label><label kind="assignment" x="-168" y="-104">c2 = 0, supported = i</label></transition></template><template><name>Connector1</name><declaration>
int msg;

clock c3;</declaration><location id="id16" x="-160" y="-32"><name x="-192" y="-80">WaitDelay</name><label kind="invariant" x="-208" y="-64">c3 &lt;= maxDelay</label></location><location id="id17" x="-16" y="-32"><name x="0" y="-40">Buffer</name></location><location id="id18" x="-360" y="-32"><name x="-416" y="-56">Empty</name></location><init ref="id18"/><transition><source ref="id16"/><target ref="id17"/><label kind="guard" x="-136" y="-32">c3 &gt;= minDelay</label></transition><transition><source ref="id18"/><target ref="id16"/><label kind="synchronisation" x="-288" y="0">finalizeToCon?</label><label kind="assignment" x="-296" y="24">msg = 1, c3 = 0</label><nail x="-320" y="24"/><nail x="-184" y="24"/></transition><transition><source ref="id17"/><target ref="id18"/><label kind="guard" x="-296" y="-160">msg == 1</label><label kind="synchronisation" x="-216" y="-160">finalizeFromCon!</label><nail x="-16" y="-136"/><nail x="-360" y="-136"/></transition><transition><source ref="id17"/><target ref="id18"/><label kind="guard" x="-296" y="-112">msg == 0</label><label kind="synchronisation" x="-224" y="-112">requestFromCon!</label><nail x="-48" y="-88"/><nail x="-328" y="-88"/></transition><transition><source ref="id16"/><target ref="id17"/><label kind="guard" x="-120" y="24">c3 == maxDelay</label><nail x="-80" y="24"/></transition><transition><source ref="id18"/><target ref="id16"/><label kind="synchronisation" x="-312" y="-56">requestToCon?</label><label kind="assignment" x="-312" y="-32">msg = 0, c3 = 0</label></transition></template><template><name>Connector2</name><declaration>
clock c4;

int msg;</declaration><location id="id19" x="456" y="0"><name x="472" y="-8">Buffer</name></location><location id="id20" x="240" y="0"><name x="216" y="-48">WaitDelay</name><label kind="invariant" x="208" y="-32">c4 &lt;= maxDelay</label></location><location id="id21" x="0" y="0"><name x="-56" y="-16">Empty</name></location><init ref="id21"/><transition><source ref="id19"/><target ref="id21"/><label kind="guard" x="112" y="-176">msg == 3</label><label kind="synchronisation" x="232" y="-176">confirmInstantiationFromCon!</label><nail x="456" y="-160"/><nail x="0" y="-160"/></transition><transition><source ref="id19"/><target ref="id21"/><label kind="guard" x="112" y="-144">msg == 2</label><label kind="synchronisation" x="240" y="-144">completedFromCon!</label><nail x="432" y="-128"/><nail x="24" y="-128"/></transition><transition><source ref="id19"/><target ref="id21"/><label kind="guard" x="112" y="-112">msg == 1</label><label kind="synchronisation" x="200" y="-112">declineInstantiationFromCon!</label><nail x="416" y="-96"/><nail x="40" y="-96"/></transition><transition><source ref="id19"/><target ref="id21"/><label kind="guard" x="120" y="-80">msg == 0</label><label kind="synchronisation" x="192" y="-80">protocolNotSupportedFromCon!</label><nail x="400" y="-64"/><nail x="48" y="-64"/></transition><transition><source ref="id20"/><target ref="id19"/><label kind="guard" x="304" y="48">c4 == maxDelay</label><nail x="288" y="48"/><nail x="416" y="48"/></transition><transition><source ref="id20"/><target ref="id19"/><label kind="guard" x="304" y="-16">c4 &gt;= minDelay</label></transition><transition><source ref="id21"/><target ref="id20"/><label kind="synchronisation" x="32" y="128">confirmInstantiationToCon?</label><label kind="assignment" x="64" y="152">c4 = 0, msg = 3</label><nail x="24" y="152"/><nail x="208" y="152"/></transition><transition><source ref="id21"/><target ref="id20"/><label kind="synchronisation" x="64" y="80">completedToCon?</label><label kind="assignment" x="72" y="104">c4 = 0, msg = 2</label><nail x="32" y="104"/><nail x="200" y="104"/></transition><transition><source ref="id21"/><target ref="id20"/><label kind="synchronisation" x="32" y="32">declineInstantiationToCon?</label><label kind="assignment" x="64" y="56">c4 = 0, msg = 1</label><nail x="32" y="56"/><nail x="192" y="56"/></transition><transition><source ref="id21"/><target ref="id20"/><label kind="synchronisation" x="24" y="-24">protocolNotSupportedToCon?</label><label kind="assignment" x="64" y="0">c4 = 0, msg = 0</label></transition></template><template><name>Final</name><location id="id22" x="0" y="0"></location><init ref="id22"/><transition><source ref="id22"/><target ref="id22"/><label kind="guard" x="-104" y="-72">requesteeFinal &amp;&amp; requestorFinal</label><nail x="-48" y="-48"/><nail x="48" y="-48"/></transition></template><system>// Place template instantiations here.
requestor = Requestor();
requestee = Requestee();
con1 = Connector1();
con2 = Connector2();
final = Final();

// List one or more processes to be composed into a system.
system requestor,requestee,con1,con2, final;</system></nta>